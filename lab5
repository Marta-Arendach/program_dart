import 'dart:async';

// –ö–ª–∞—Å –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ –º–∞—Ä—à—Ä—É—Ç
class Marshrut {
  int hour;
  int passengers;
  String comment;

  Marshrut(this.hour, this.passengers, this.comment);

  int get getHour => hour;
  int get getPassengers => passengers;
  String get getComment => comment;

  set setHour(int h) => hour = h;
  set setPassengers(int p) => passengers = p;
  set setComment(String c) => comment = c;

  @override
  String toString() =>
      '–ì–æ–¥–∏–Ω–∞: $hour, –ø–∞—Å–∞–∂–∏—Ä—ñ–≤: $passengers, –∫–æ–º–µ–Ω—Ç–∞—Ä: $comment';
}

// üîπ Generic-–∫–ª–∞—Å
class Collection<T> {
  List<T> items = [];

  void addItem(T item) => items.add(item);

  // Generic-–º–µ—Ç–æ–¥ 1 ‚Äî –≤–∏–≤—ñ–¥ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
  void showAll<U>(U Function(T) converter) {
    for (var item in items) {
      print(converter(item));
    }
  }

  // Generic-–º–µ—Ç–æ–¥ 2 ‚Äî –ø–æ—à—É–∫ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
  T findMin<U extends Comparable>(U Function(T) selector) {
    if (items.isEmpty) throw Exception('–ö–æ–ª–µ–∫—Ü—ñ—è –ø–æ—Ä–æ–∂–Ω—è');
    T minItem = items.first;
    U minValue = selector(minItem);
    for (var item in items) {
      if (selector(item).compareTo(minValue) < 0) {
        minItem = item;
        minValue = selector(item);
      }
    }
    return minItem;
  }

  // Generic-–º–µ—Ç–æ–¥ 3 ‚Äî –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º–∏ —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è
  num sumBy<U extends num>(U Function(T) selector) {
    num sum = 0;
    for (var item in items) {
      sum += selector(item);
    }
    return sum;
  }

  // üî∏ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ generic-—Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó ‚Ññ4

  // 1Ô∏è‚É£ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ Future(() { ... })
  Future<num> asyncSumBy<U extends num>(U Function(T) selector) {
    return Future(() {
      print('–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å—É–º–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ...');
      return sumBy(selector);
    });
  }

  // 2Ô∏è‚É£ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ Future.value()
  Future<T> asyncFindMin<U extends Comparable>(U Function(T) selector) {
    print('–ü–æ—à—É–∫ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ (Future.value)...');
    return Future.value(findMin(selector));
  }

  // 3Ô∏è‚É£ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑ —ñ–º—ñ—Ç–∞—Ü—ñ—î—é –∑–∞—Ç—Ä–∏–º–∫–∏ (Future.delayed)
  Future<void> asyncShowAll<U>(U Function(T) converter) async {
    print('–í–∏–≤—ñ–¥ —É—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é...');
    for (var item in items) {
      await Future.delayed(Duration(milliseconds: 300), () {
        print(converter(item));
      });
    }
  }
}

// üîπ –ö–ª–∞—Å —Ç—Ä–∞–º–≤–∞–π–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏
class TramStop {
  String name;
  List<int> routes;
  Collection<Marshrut> marshruts;

  TramStop(this.name, this.routes, this.marshruts);

  int totalPassengers() => marshruts.sumBy((m) => m.passengers).toInt();

  int hourWithMinPassengers() => marshruts.findMin((m) => m.passengers).hour;

  String longestComment() =>
      marshruts.findMin((m) => -m.comment.length).comment;

  void showResults() {
    print('–ó—É–ø–∏–Ω–∫–∞: $name');
    print('–ú–∞—Ä—à—Ä—É—Ç–∏: ${routes.join(", ")}');
    print('–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Å–∞–∂–∏—Ä—ñ–≤: ${totalPassengers()}');
    print('–ì–æ–¥–∏–Ω–∞ –∑ –Ω–∞–π–º–µ–Ω—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø–∞—Å–∞–∂–∏—Ä—ñ–≤: ${hourWithMinPassengers()}');
    print('–ù–∞–π–¥–æ–≤—à–∏–π –∫–æ–º–µ–Ω—Ç–∞—Ä: "${longestComment()}"');
  }
}

// üî∏ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è main –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
Future<void> main() async {
  var marshrutCollection = Collection<Marshrut>();
  marshrutCollection.addItem(Marshrut(8, 30, '–†–∞–Ω–∫–æ–≤–∏–π –Ω–∞–ø–ª–∏–≤'));
  marshrutCollection.addItem(Marshrut(10, 15, '–ú–∞–ª–æ –ª—é–¥–µ–π'));
  marshrutCollection.addItem(Marshrut(14, 22, '–ü–æ–º—ñ—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Å–∞–∂–∏—Ä—ñ–≤'));
  marshrutCollection.addItem(Marshrut(18, 40, '–í–µ—á—ñ—Ä–Ω—ñ–π –ø—ñ–∫'));

  TramStop stop = TramStop('–í–æ–∫–∑–∞–ª—å–Ω–∞', [1, 3, 5], marshrutCollection);
  
  stop.showResults(); //  –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–º—ñ–Ω–Ω—É stop


  try {
    print('--- –ü–æ—á–∞—Ç–æ–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å ---');

    // –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
    await marshrutCollection.asyncShowAll((m) => m.toString());

    var sum = await marshrutCollection.asyncSumBy((m) => m.passengers);
    print('\n[1] –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Å–∞–∂–∏—Ä—ñ–≤ (Future): $sum');

    var minMarshrut = await marshrutCollection.asyncFindMin((m) => m.passengers);
    print('[2] –ì–æ–¥–∏–Ω–∞ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø–∞—Å–∞–∂–∏—Ä—ñ–≤: ${minMarshrut.hour}');

    print('--- –£—Å—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ ---');
  } catch (e) {
    print('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è—Ö: $e');
  }
}
